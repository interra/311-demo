{
    "title": "Philly 311 Data Visualized",
    "backend": "cartodb",
    "dataResources": [
        {
            "resourceHandle": "philly_311",
            "resourceType": "cartodb",
            "url": "https://phl.carto.com/api/v2/sql",
            "query": "?q=SELECT service_name, COUNT(cartodb_id) FROM public_cases_fc WHERE service_name NOT IN ('Information Request') GROUP BY service_name ORDER BY count DESC LIMIT 10"
        }
    ],
    "regions": [
        {
            "id": "filters",
            "className": "col-md-6",
            "children": [
                {
                    "type": "NeighborhoodFilter",
                    "filterKey": "neighborhood",
                    "componentKey": "neighborhoodMap",
                    "leafletSettings":
                        { 
                          "center": [39.9728, -75.1638],
                          "zoomControl": false,
                          "zoom": 10.7, 
                          "maxZoom": 19, 
                          "minZoom": 6, 
                          "scrollWheelZoom": false,
                          "legends": true,
                          "infoControl": false,
                          "attributionControl": true,
                          "selectedFillColor": "red",
                          "selectedFillOpacity": 0.65,
                          "unselectedFillColor": "transparent",
                          "unselectedFillOpacity": 0,
                          "tileUrl": "http://{s}.tile.osm.org/{z}/{x}/{y}.png",
                          "tileAttr": "&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors"
                        },
                    "choroplethSettings": {
                        "choroplethStyle": {
                            "fillColor": "#F28F3B",
                            "weight": 2,
                            "opacity": 1,
                            "color": "white",
                            "dashArray": 3,
                            "fillOpacity": 0.5
                        },
                        "choroplethColorScale": ["#f1eef6", "#d7b5d8", "#df65b0", "#dd1c77", "#980043"],
                        "steps": 5,
                        "legendCaption": "Requests per Neighborhood:",
                        "mode": "e"
                    },
                    "cardProps": {
                        "subheader": "Click neighborhood to see aggregate data (One neighborhood at a time for query speed). Use select filter below to visualize requests by neighborhood."
                    },
                    "multi": true,
                    "className": "map-left"
                },
                {
                    "type": "Autocomplete",
                    "filterKey": "service_name",
                    "label": "Show map values by 311 request type",
                    "className": "filter-right",
                    "willFilter": ["philly_311"],
                    "field": "service_name",
                    "multi": false,
                    "noData": true,
                    "operation": "IN",
                    "options": 
			[
			    {"label": "Miscellaneous", "value": "Miscellaneous"},
			    {"label": "Maintenance Residential or Commercial", "value": "Maintenance Residential or Commercial"},
			    {"label": "Rubbish/Recyclable Material Collection", "value":"Rubbish/Recyclable Material Collection"}, 
			    {"label": "Illegal Dumping", "value": "Illegal Dumping"},                
			    {"label": "Abandoned Vehicle", "value":"Abandoned Vehicle"},                      
			    {"label": "Graffiti Removal", "value": "Graffiti Removal"},                       
			    {"label": "Street Defect", "value": "Street Defect"},     
			    {"label": "Street Light Outage", "value": "Street Light Outage"},                 
			    {"label": "Vacant Lot Clean-Up", "value": "Vacant Lot Clean-Up"},
			    {"label": "Vacant House or Commercial", "value": "Vacant House or Commercial"},
			    {"label": "Salting", "value": "Salting"},                           
			    {"label": "Sanitation / Dumpster Violation", "value": "Sanitation / Dumpster Violation"},
			    {"label": "Traffic Signal Emergency", "value": "Traffic Signal Emergency"},
			    {"label": "Street Trees", "value": "Street Trees"},     
			    {"label": "Building Dangerous", "value": "Building Dangerous"},                 
			    {"label": "Smoke Detector", "value": "Smoke Detector"},   
			    {"label": "Building Construction", "value": "Building Construction"}, 
			    {"label": "Construction Site Task Force", "value": "Construction Site Task Force"}
                        ]
                }
            ]
        },
        {
            "id": "region-1",
            "className": "col-md-6",
            "children": [
                {
                    "type": "Chart",
                    "componentKey": "chart-3",
                    "cardProps": {
                        "header": "Common 311 Requests by Region",
                        "subheader": "Excluding Information Requests (see table below)"
                    },
                    "dataType": "NVD3PieChartSeries",
                    "resourceHandle": "philly_311",
                    "count": "service_name",
                    "limit": 10,
                    "where": [
                        {
                            "op": "notIn",
                            "attribute": "service_name",
                            "value": ["Information Request"]
                        }
                    ],
                    "x": "service_name",
                    "y": "count",
                    "dataFields": [
                        {
                            "resourceHandle": "philly_311",
                            "field": "service_name",
                            "type": "STRING",
                            "fieldHandle": "serviceName"
                        },
                        {
                            "resourceHandle": "philly_311",
                            "field": "count",
                            "type": "INTEGER",
                            "fieldHandle": "count"
                        }
                    ],
                    "settings": {
                        "type": "pieChart",
                        "rotateLabels": 45,
                        "height": 700,
                        "legend": {
                            "maxKeyLength": 1500
                        }
                    }
                }
	    ]
        },
        {
            "id": "region-3",
            "className": "col-md-12",
            "children": [
                {
                    "type": "Table",
                    "cardProps": {
                        "header": "Information requests by Agency",
                        "subheader": "Click column headers to sort. Browsing controls at bottom of table."
                    },
                    "resourceHandle": "philly_311",
                    "componentKey": "table-a",
                    "count": "agency_responsible",
                    "settings": {
                        "columns": [
                            {"Header": "Agency Responsible", "accessor": "agency_responsible"},
                            {"Header": "Total Requests", "accessor": "count"}
                        ]
                    },
                    "where": [
                        {
                            "attribute": "service_name",
                            "value": "Information Request"
                        }
                    ]
                }
            ]
        }
   ]
}
